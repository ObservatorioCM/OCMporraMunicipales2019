<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>OCMporraMunicipales2019</title>
  <base href="/">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
  <!-- Codigo copiado de la pagina La Sexta. -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href='https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300' rel='stylesheet' type='text/css'>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.min.js"></script>
<link rel='stylesheet' href='https://cdn.jsdelivr.net/combine/gh/ahmst/basis@1.32/grid.css,gh/ahmst/basis@1.32/classes.css'/>
<script src="https://unpkg.com/tippy.js@3/dist/tippy.all.min.js" defer=""></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
<script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.js"></script>

<div id="pactometro2019">
    <div id="visor-parlamento">
        <div id="mayoria" data-tippy="Mayoría absoluta: 14 concejales" data-tippy-animation="shift-away" data-tippy-arrow="true"></div>
        <div id="recuento" class="recuento">
            <span id="diputados-asignados">0</span>
            <span class="diputados-texto">Concejales asignados</span>
            <span class="diputados-totales">de 27</span>
            <div id="avance">
                <div id="bar"></div>
            </div>
        </div>
        <div id="recuento2" class="recuento">
            <span id="diputados-suma">0</span>
            <span class="diputados-texto">Concejales en tu pacto</span>
            <span class="diputados-totales">elige tus partidos</span>
            <div id="viabilidad" class="cY off">
                    <div id="exito" class="cXY off">
                        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDQyNi42NjcgNDI2LjY2NyIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDI2LjY2NyA0MjYuNjY3OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIGNsYXNzPSIiPjxnPjxwYXRoIHN0eWxlPSJmaWxsOiM3MDlEMUEiIGQ9Ik0yMTMuMzMzLDBDOTUuNTE4LDAsMCw5NS41MTQsMCwyMTMuMzMzczk1LjUxOCwyMTMuMzMzLDIxMy4zMzMsMjEzLjMzMyAgYzExNy44MjgsMCwyMTMuMzMzLTk1LjUxNCwyMTMuMzMzLTIxMy4zMzNTMzMxLjE1NywwLDIxMy4zMzMsMHogTTE3NC4xOTksMzIyLjkxOGwtOTMuOTM1LTkzLjkzMWwzMS4zMDktMzEuMzA5bDYyLjYyNiw2Mi42MjIgIGwxNDAuODk0LTE0MC44OThsMzEuMzA5LDMxLjMwOUwxNzQuMTk5LDMyMi45MTh6IiBkYXRhLW9yaWdpbmFsPSIjNkFDMjU5IiBjbGFzcz0iYWN0aXZlLXBhdGgiIGRhdGEtb2xkX2NvbG9yPSIjNzA5ZDFhIj48L3BhdGg+PC9nPiA8L3N2Zz4=" />
                        <span class="desktop">Tu pacto sería viable</span>
                        <span class="mobile">Mayoría absoluta</span>
                    </div>
                    <div id="fracaso" class="cXY off">
                        <img src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA0OTYuMTU4IDQ5Ni4xNTgiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ5Ni4xNTggNDk2LjE1ODsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSI1MTJweCIgaGVpZ2h0PSI1MTJweCI+CjxwYXRoIHN0eWxlPSJmaWxsOiNFMDRGNUY7IiBkPSJNNDk2LjE1OCwyNDguMDg1YzAtMTM3LjAyMS0xMTEuMDctMjQ4LjA4Mi0yNDguMDc2LTI0OC4wODJDMTExLjA3LDAuMDAzLDAsMTExLjA2MywwLDI0OC4wODUgIGMwLDEzNy4wMDIsMTExLjA3LDI0OC4wNywyNDguMDgyLDI0OC4wN0MzODUuMDg4LDQ5Ni4xNTUsNDk2LjE1OCwzODUuMDg3LDQ5Ni4xNTgsMjQ4LjA4NXoiLz4KPHBhdGggc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIGQ9Ik0yNzcuMDQyLDI0OC4wODJsNzIuNTI4LTg0LjE5NmM3LjkxLTkuMTgyLDYuODc2LTIzLjA0MS0yLjMxLTMwLjk1MSAgYy05LjE3Mi03LjkwNC0yMy4wMzItNi44NzYtMzAuOTQ3LDIuMzA2bC02OC4yMzYsNzkuMjEybC02OC4yMjktNzkuMjEyYy03LjkxLTkuMTg4LTIxLjc3MS0xMC4yMTYtMzAuOTU0LTIuMzA2ICBjLTkuMTg2LDcuOTEtMTAuMjE0LDIxLjc3LTIuMzA0LDMwLjk1MWw3Mi41MjIsODQuMTk2bC03Mi41MjIsODQuMTkyYy03LjkxLDkuMTgyLTYuODgyLDIzLjA0MSwyLjMwNCwzMC45NTEgIGM0LjE0MywzLjU2OSw5LjI0MSw1LjMxOCwxNC4zMTYsNS4zMThjNi4xNjEsMCwxMi4yOTQtMi41ODYsMTYuNjM4LTcuNjI0bDY4LjIyOS03OS4yMTJsNjguMjM2LDc5LjIxMiAgYzQuMzM4LDUuMDQxLDEwLjQ3LDcuNjI0LDE2LjYzNyw3LjYyNGM1LjA2OSwwLDEwLjE2OC0xLjc0OSwxNC4zMTEtNS4zMThjOS4xODYtNy45MSwxMC4yMi0yMS43NywyLjMxLTMwLjk1MUwyNzcuMDQyLDI0OC4wODJ6Ii8+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+Cjwvc3ZnPgo=" />
                        <span class="desktop">No obtendría mayoría</span>
                        <span class="mobile">Sin mayoría</span>
                    </div>
                </div>
        </div>
        <canvas id="myChart" ></canvas>
    </div>

<div id="paso1" class="paso">
    <h3><span>1</span><span>Configura la Corporación.</span></h3>
    <span class="boton" id="boton-reset" onclick="resetCongreso()">Vaciar Corporación</span>
    <p>Este es la Corporación actual. <span class="desktop">Juega a quitar y añadir</span><span class="mobile">Quita y añade</span> concejales hasta construir tu Corporación con 27 concejales.
       <span class="desktop">Si prefieres empezar de cero, pulsa sobre </span><!--<span class="mobile">Si lo prefieres, puedes </span>--><br class="mobile"/>
       <span class="reset"onclick="resetCongreso()">Vaciar Corporación</span><span class="desktop">.</span></p>
    <ul class="listapartidos dst8 dstm3">
        <li class="partido-pp selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">PP</span>
            <span class="diputados-partido" bind="any_name">11</span>
            <span class="boton sumar">+</span>
        </li>
        <li class="partido-psoe selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">PSOE</span>
            <span class="diputados-partido">7</span>
            <span class="boton sumar">+</span>
        </li>
        <li class="partido-podemos selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">Ganemos</span>
            <span class="diputados-partido">5</span>
            <span class="boton sumar">+</span>
        </li>
        <li class="partido-ciudadanos selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">CIUDADANOS</span>
            <span class="diputados-partido">2</span>
            <span class="boton sumar">+</span>
        </li>
        <li class="partido-vox selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">Adelante Jerez</span>
            <span class="diputados-partido">2</span>
            <span class="boton sumar">+</span>
        </li>
        <li class="partido-erc selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">VOX</span>
            <span class="diputados-partido">0</span>
            <span class="boton sumar">+</span>
        </li>
        <li class="partido-pdecat selector box" >
            <span class="boton restar">-</span>
            <span class="nombre-partido">Jerezanos</span>
            <span class="diputados-partido">0</span>
            <span class="boton sumar">+</span>
        </li>
        <li class="partido-pnv selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">AxSi</span>
            <span class="diputados-partido">0</span>
            <span class="boton sumar">+</span>
        </li>
        <li class="partido-compromis selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">PCPA</span>
            <span class="diputados-partido">0</span>
            <span class="boton sumar">+</span>
        </li>
       <!--    
        <li class="partido-bildu selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">EH BILDU</span>
            <span class="diputados-partido">0</span>
            <span class="boton sumar">+</span>
        </li>
        <li class="partido-upn selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">UPN</span>
            <span class="diputados-partido">2</span>
            <span class="boton sumar">+</span>
        </li>
        <li class="partido-cc selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">CC</span>
            <span class="diputados-partido">1</span>
            <span class="boton sumar">+</span>
        </li>
        <li class="partido-fac selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">FAC</span>
            <span class="diputados-partido">1</span>
            <span class="boton sumar">+</span>
        </li>
        <li class="partido-nc selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">NC</span>
            <span class="diputados-partido">1</span>
            <span class="boton sumar">+</span>
        </li>
        <li class="partido-pacma selector box" >
            <span class="boton restar">-</span>
            <span class="nombre-partido">PACMA</span>
            <span class="diputados-partido">0</span>
            <span class="boton sumar">+</span>
        </li>
        <li class="partido-prc selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">PRC</span>
            <span class="diputados-partido">0</span>
            <span class="boton sumar">+</span>
        </li> -->

    </ul>
</div>
<div id="paso2" class="paso">
        <h3><span>2</span><span>Simula un pacto</span></h3>
        <div id="mensajes">
                <p class="no-completado">Podrás simular tu pacto de Gobierno una vez hayas configurado la Corporación al completo (27 concejales).</p>
                <p class="completado">Ahora que todos los concejales están asignados, estás listo para pactar.<br/><span class="button">Empezar</span></span></p>
                <p class="completado pactos"><span class="mobile">Es el momento de pactar: pulsa sobre cada partido hasta alcanzar mayoría absoluta (14 concejales)</span>
                  <span class="desktop">Es el momento de hacer tu pacto: simúlalo pulsando sobre cada partido hasta alcanzar mayoría absoluta (14 concejales).</span></p>
        </div>
        <ul class="listapartidos dst16 dstm4">
                <li class="partido-pp selector box">
                    <span class="nombre-partido nombre-partido-short">PP</span>
                    <span class="diputados-partido" bind="any_name">134</span>
                </li>
                <li class="partido-psoe selector box">
                    <span class="nombre-partido nombre-partido-short">PSOE</span>
                    <span class="diputados-partido">84</span>
                </li>
                <li class="partido-podemos selector box">
                    <span class="nombre-partido">U. PODEMOS</span>
                    <span class="nombre-partido-short">UP</span>
                    <span class="diputados-partido">67</span>
                </li>
                <li class="partido-ciudadanos selector box">
                    <span class="nombre-partido">CIUDADANOS</span>
                    <span class="nombre-partido-short">Cs</span>
                    <span class="diputados-partido">32</span>
                </li>
                <li class="partido-vox selector box">
                    <span class="nombre-partido nombre-partido-short">VOX</span>
                    <span class="diputados-partido">0</span>
                </li>
                <li class="partido-erc selector box">
                    <span class="nombre-partido nombre-partido-short">ERC</span>
                    <span class="diputados-partido">9</span>
                </li>
                <li class="partido-pdecat selector box" >
                    <span class="nombre-partido nombre-partido-short">PdeCAT</span>
                    <span class="diputados-partido">8</span>
                </li>
                <li class="partido-pnv selector box">
                    <span class="nombre-partido nombre-partido-short">PNV</span>
                    <span class="diputados-partido">5</span>
                </li>
                <li class="partido-compromis selector box">
                    <span class="nombre-partido">COMPROMÍS</span>
                    <span class="nombre-partido nombre-partido-short">CMP</span>
                    <span class="diputados-partido">4</span>
                </li>
                <li class="partido-bildu selector box">
                    <span class="nombre-partido">EH BILDU</span>
                    <span class="nombre-partido nombre-partido-short">Bildu</span>
                    <span class="diputados-partido">2</span>
                </li>
                <li class="partido-upn selector box">
                    <span class="nombre-partido nombre-partido-short">UPN</span>
                    <span class="diputados-partido">2</span>
                </li>
                <li class="partido-cc selector box">
                    <span class="nombre-partido nombre-partido-short">CC</span>
                    <span class="diputados-partido">1</span>
                </li>
                <li class="partido-fac selector box">
                    <span class="nombre-partido nombre-partido-short">FAC</span>
                    <span class="diputados-partido">1</span>
                </li>
                <li class="partido-nc selector box">
                    <span class="nombre-partido nombre-partido-short">NC</span>
                    <span class="diputados-partido">1</span>
                </li>
                <li class="partido-pacma selector box">
                    <span class="nombre-partido nombre-partido-short">PACMA</span>
                    <span class="diputados-partido">0</span>
                </li>
                <li class="partido-prc selector box">
                    <span class="nombre-partido nombre-partido-short">PRC</span>
                    <span class="diputados-partido">0</span>
                </li>

            </ul>
</div>

    <!--<button onclick="cambiarDatos(myChart, nuevosEscano, 0)">Cambiar Datos</button>-->
</div>

<script>
        const escanosIniciales = [11, 7, 5, 2, 2, 0, 0, 0, 0];
        //let nuevosEscano = [14, 94, 62, 37, 6, 8, 5, 7, 1, 3, 0, 2, 0, 1];

        function cambiarDatos(chart, data, datasetIndex) {
            chart.data.datasets[datasetIndex].data = data;
            chart.update();
        }

        var ctx = document.getElementById("myChart");
        var myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ["PP", "PSOE", "Ganemos", "Ciudadanos", "Adelante Jerez", "VOX", "Jerezanos", "AxSi", "PCPA", "Por asignar"],
                datasets: [{
                    label: 'Escaños',
                    data: escanosIniciales,
                    backgroundColor: [
                        'rgba(39, 159, 213, 1)', //PP
                        'rgba(214, 24, 36, 1)', //PSOE
                        'rgba(109, 45, 95, 1)', //Ganemos
                        'rgba(240, 133, 58, 1)', //CIUDADANOS
                        'rgba(129, 192, 59, 1)', //Adelante Jerez
                        'rgba(250, 188, 67, 1)', //VOX
                        'rgba(13, 110, 164, 1)', //Jerezanos
                        'rgba(69, 99, 47, 1)', //AxSi
                        'rgba(206, 107, 41, 1)', //PCPA
                        'rgba(234, 234, 234, 1)' //POR ASIGNAR

                    ],
                    borderColor: [
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                rotation: 1 * Math.PI,
                circumference: 1 * Math.PI,
                legend: false
            }
        });

    //MOSTRAR CAJAS PARTIDOS
    function mostrarCajasPartidos(selector) {
        $(selector).removeClass("shown");
        $(selector).each(function(i,el) {
            $(el).delay(40*i).queue(function() {
                $(this).addClass('shown').dequeue();
            });
        });
    }
    mostrarCajasPartidos("#pactometro2019 > #paso1 ul.listapartidos li");

    //CALCULO DIPUTADOS CONFIGURADOS
    function GetTotalDiputados() {
        totalDiputados = 0;
        arrayDiputados = [];
        $("#pactometro2019 > #paso1 ul.listapartidos li").each(function() {
            var numDiputadosSingle = parseInt($(this).find("span.diputados-partido").text());
            totalDiputados = totalDiputados + numDiputadosSingle;
            //array partidos
            arrayDiputados.push(numDiputadosSingle);
            faltanDiputados = 27 - totalDiputados;
        });

        //actualizar barra progreso
        $("#pactometro2019 > #visor-parlamento #recuento #diputados-asignados").text(totalDiputados);
        var porcentajeProgresoBarra = totalDiputados * 100 / 27;
        $("#pactometro2019 > #visor-parlamento #recuento #avance #bar").width(porcentajeProgresoBarra + "%");

        //actualizar Corporación
        arrayDiputados.push(faltanDiputados);
        cambiarDatos(myChart, arrayDiputados, 0)

        //estado
        if(totalDiputados == 27) {
            congresoCompletado = "si";
            $("#pactometro2019").addClass("completado");
        } else {
            congresoCompletado = "no";
            $("#pactometro2019").removeClass("completado");
        }

        return totalDiputados;
    }
    GetTotalDiputados();

    //RESET CONGRESO
    function resetCongreso() {
    $("#pactometro2019 > .paso ul.listapartidos .selector .diputados-partido").text(0);
    GetTotalDiputados();
    }

    //SUMAR Y RESTAR

    //mensajes de error
    function showError(tipo, modal) {
        if (tipo == "completado") {
            Swal.fire({
                title: "¡Corporación completada!",
                text: "Has asignado los 27 concejales de la Corporación. Simula ahora tu pacto o, si prefieres hacer algún cambio, redistruye los concejales.",
                confirmButtonText: 'Redistribuir concejales',
                cancelButtonText: 'Pactar',
                showCancelButton: true
                }).then((result) => {
                    if (result.value) {
                        //console.log("seguir configurando");
                    } else if (
                        result.dismiss === Swal.DismissReason.cancel
                    ) {
                        modoPactos();
                    }
                    })
        } else if (tipo == "minimo") {
            Swal.fire({title: "Has llegado al mínimo", text: "Un partido no puede tener menos de 0 concejales", confirmButtonText: 'Aceptar'})
        } else if (tipo == "insuficiente") {
            Swal.fire({title: "Aún te quedan " + modal + " concejales por asignar", text: "Para poder realizar tu pacto, es necesario asignar todos los concejales de Corporacion (27 concejales)", confirmButtonText: 'Aceptar'})
        } else if (tipo == "tope") {
            Swal.fire({title: "Ya están asignados todos los concejales", text: "Resta concejales de otro partido e inténtalo de nuevo.", confirmButtonText: 'Aceptar'})
            Swal.fire({
                title: "Ya están asignados todos los concejales",
                text: "Resta concejales de otro partido e inténtalo de nuevo. Si lo prefieres, simula ahora tu pacto.",
                confirmButtonText: 'Seguir configurando',
                cancelButtonText: 'Pactar',
                showCancelButton: true
                }).then((result) => {
                    if (result.value) {
                        //console.log("seguir configurando");
                    } else if (
                        result.dismiss === Swal.DismissReason.cancel
                    ) {
                        modoPactos();
                    }
                    })

        }
    }

    function asignarDiputados(operacion, objeto) {
        GetTotalDiputados();
        var objNumDiputados = $("#pactometro2019 > #paso1 ul.listapartidos li." + objeto).find(".diputados-partido");
        var objNumDiputadosTodos = $("li." + objeto).find(".diputados-partido");
        numDiputadosSingle = parseInt(objNumDiputados.text());
        if (operacion == "sumar") {
            if ((totalDiputados == 349)) {
                numDiputadosSingle = numDiputadosSingle + 1;
                //showError("completado");
            } else if ((totalDiputados == 350)) {
                showError("tope");
            } else if ((numDiputadosSingle < 350) && (totalDiputados < 350)) {
                numDiputadosSingle = numDiputadosSingle + 1;
            } else {
                showError("tope");
            }
        } else if (operacion == "restar") {
            if (numDiputadosSingle > 0) {
                numDiputadosSingle = numDiputadosSingle - 1;
            } else {
                showError("minimo");
            }
        }
        $(objNumDiputadosTodos).text(numDiputadosSingle);
        GetTotalDiputados();
    }

    $("#pactometro2019 > #paso1 ul.listapartidos li span.boton").click(function() {
        //var objNumDiputados = $(this).parent().find(".diputados-partido");
        var partidoClass = $(this).parent().attr('class').split(' ')[0];
        if($(this).hasClass("sumar")) {
            asignarDiputados("sumar", partidoClass );
        } else if($(this).hasClass("restar")) {
            asignarDiputados("restar", partidoClass );
        }
    });

                //LONG PRESS
                !function(o){o.fn.longpress=function(e,n,t){return void 0===t&&(t=500),this.each(function(){var u,i,r=o(this);function c(n){u=(new Date).getTime();var r=o(this);i=setTimeout(function(){"function"==typeof e?e.call(r,n):o.error("Callback required for long press. You provided: "+typeof e)},t)}function s(e){(new Date).getTime()-u<t&&(clearTimeout(i),"function"==typeof n?n.call(o(this),e):void 0===n||o.error("Optional callback for short press should be a function."))}function a(o){clearTimeout(i)}r.on("mousedown",c),r.on("mouseup",s),r.on("mousemove",a),r.on("touchstart",c),r.on("touchend",s),r.on("touchmove",a)})}}(jQuery);

                var interval;
                $('#pactometro2019 > #paso1 ul.listapartidos li span.boton').longpress(function() {
                    var thislongpress = $(this);
                    var partidoClass = $(this).parent().attr('class').split(' ')[0];
                    function performWhileMouseDown() {
                        //definir operacion
                        if(thislongpress.hasClass("sumar")) {
                            operacion = "sumar";
                        } else {operacion = "restar";}
                        //ejecutar
                        if((totalDiputados == 27) && (operacion == "sumar")) {
                            clearInterval(interval);
                            showError("completado");
                        } else if ((thislongpress.parent().find(".diputados-partido").text() == 0) && (operacion == "restar")) {
                            clearInterval(interval);
                            showError("minimo");
                        } else {asignarDiputados(operacion, partidoClass);}
                    }
                    interval = setInterval(performWhileMouseDown, 20);
                }).bind( "mouseup touchend", function(){
                    clearInterval(interval);
                }).bind( "mousedown touchstart", function(){
                });


    //PACTOS: VIABILIDAD
    function checkViabilidadPacto(numerodiputados) {
        if(numerodiputados == 0) {
            $("#pactometro2019 > #visor-parlamento .recuento #viabilidad").addClass("off");
            $("#pactometro2019 > #visor-parlamento .recuento #viabilidad > div").removeClass("on").addClass("off");
        }
        else if(numerodiputados < 14) {
            $("#pactometro2019 > #visor-parlamento .recuento #viabilidad").removeClass("off");
            $("#pactometro2019 > #visor-parlamento .recuento #viabilidad #exito").removeClass("on").addClass("off");
            $("#pactometro2019 > #visor-parlamento .recuento #viabilidad #fracaso").addClass("on").removeClass("off");
            return "inviable";
        } else {
            $("#pactometro2019 > #visor-parlamento .recuento #viabilidad #exito").addClass("on").removeClass("off");
            $("#pactometro2019 > #visor-parlamento .recuento #viabilidad #fracaso").removeClass("on").addClass("off");
            return "viable";
        }
    };

    //PACTOS
    function initPactos() {
        $("#pactometro2019.completado.pactos > #visor-parlamento #recuento2 #diputados-suma").text(0);
        $('#pactometro2019 > #visor-parlamento #recuento2 .diputados-totales').text("elige tus partidos");
        $("#pactometro2019 > #paso2 ul.listapartidos li").removeClass("seleccionado");
        congresoPactos = [11, 7, 5, 2, 2, 0, 0, 0, 0], 27;
        partidosPactos = [];
        cambiarDatos(myChart, congresoPactos, 0);
        checkViabilidadPacto(0);
    }
    function modoPactos() {
        $("#pactometro2019 > #paso2 ul.listapartidos li").removeClass("shown");
        $("#pactometro2019 > #paso1").addClass("off");
        $("#pactometro2019").addClass("pactos");
        initPactos();
        setTimeout(function(){ mostrarCajasPartidos("#pactometro2019 > #paso2 ul.listapartidos li"); }, 300);
    }
    function modoCongreso() {
        GetTotalDiputados();
        $("#pactometro2019 > #paso1").removeClass("off");
        $("#pactometro2019").removeClass("pactos pactosinit");
        mostrarCajasPartidos("#pactometro2019 > #paso1 ul.listapartidos li");
    }

    $("#pactometro2019 > #paso2").click(function() {
        if((!$("#pactometro2019").hasClass("pactos")) && (!$("#pactometro2019").hasClass("completado")))  {
            showError("insuficiente", faltanDiputados)
        }
    })

    $("#pactometro2019 > #paso2 p .button").click(function() {
        modoPactos();
    })

    $("#pactometro2019 > #paso1").click(function() {
        if($(this).hasClass('off')) {
            modoCongreso();
        }
    });

    //PACTOS: CLICK EN PARTIDO
    $("#pactometro2019 > #paso2 > .listapartidos li").click(function() {
            //recabar datos
            var numDiputadosSingle = parseInt($(this).find(".diputados-partido").text());
            var childPartido = $(this).index();
            var nombrePartido =$(this).find(".nombre-partido-short").text();
            function getSum(total, num) {return total + num;}

            //SI NO HA SIDO SELECCIONADO AUN
            if (!$(this).hasClass("seleccionado")) {
                    //asignar número de diputados al índice del array correspondiente al partido
                    congresoPactos[childPartido] = numDiputadosSingle;
                    //reset número diputados sin asignar en el pacto
                    congresoPactos[16] = 0;
                    //sumar en array nombres partidos
                    partidosPactos.push(nombrePartido);
                    $('#pactometro2019 > #visor-parlamento #recuento2 .diputados-totales').text("");
                    $.each(partidosPactos, function(index, value){
                        $('#pactometro2019 > #visor-parlamento #recuento2 .diputados-totales').append( '<span class="' + value + '">' + value +'</span><span class="mas"> + </span> ')
                    });
                    //get suma diputados partidos en el pacto
                    congresoPactosTotal = congresoPactos.reduce(getSum);
                    $("#pactometro2019.completado.pactos > #visor-parlamento #recuento2 #diputados-suma").text(congresoPactosTotal);
                    //get total sin asignar
                    congresoPactosTotalSinAsignar = 350 - congresoPactosTotal;
                    congresoPactos[16] = congresoPactosTotalSinAsignar;
                    //marcar como seleccionado
                    $(this).addClass("seleccionado");

            //SI YA HA SIDO SELECCIONADO
            } else {
                    //asignar número de diputados al índice del array correspondiente al partido
                    congresoPactos[childPartido] = 0;
                    //reset número diputados sin asignar en el pacto
                    congresoPactos[16] = 0;
                    //restar en array de nombres partidos
                    partidosPactos = partidosPactos.filter(function(e) { return e !== nombrePartido });

                    $('#pactometro2019 > #visor-parlamento .recuento .diputados-totales span.' + nombrePartido).remove();
                    if(partidosPactos.length == 1) {$('#pactometro2019 > #visor-parlamento .recuento .diputados-totales span.mas').remove(); }
                    //get suma diputados partidos en el pacto
                    congresoPactosTotal = congresoPactos.reduce(getSum);
                    $("#pactometro2019.completado.pactos > #visor-parlamento #recuento2 #diputados-suma").text(congresoPactosTotal);
                    //get total sin asignar
                    congresoPactosTotalSinAsignar = 350 - congresoPactosTotal;
                    congresoPactos[16] = congresoPactosTotalSinAsignar
                    //marcar como seleccionado
                    $(this).removeClass("seleccionado");
            }
            if(partidosPactos == 0) {
                $('#pactometro2019 > #visor-parlamento #recuento2 .diputados-totales').text("elige tus partidos");
            }
        //¿exito en el pacto?
        checkViabilidadPacto(congresoPactosTotal);

    cambiarDatos(myChart, congresoPactos, 0);
    })
    </script>
<app-root><app-root></app-root>
</body>

</html>
