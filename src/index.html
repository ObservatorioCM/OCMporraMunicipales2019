<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>OCM pactometro 2019</title>
    <base href="/" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://github.com/niklasvh/html2canvas/releases/download/v1.0.0-rc.1/html2canvas.min.js"></script>

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css"
      integrity="sha384-wXznGJNEXNG1NFsbm0ugrLFMQPWswR3lds2VeinahP8N0zJw9VWSopbjv2x7WCvX"
      crossorigin="anonymous"
    />
    <link
      href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons"
    />
  </head>

  <body>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://cdn.jsdelivr.net/combine/gh/ahmst/basis@1.32/grid.css,gh/ahmst/basis@1.32/classes.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script
      src="https://unpkg.com/tippy.js@3/dist/tippy.all.min.js"
      defer=""
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/svg4everybody/2.1.9/svg4everybody.min.js"></script>

    <style>
      body {
        opacity: 0;
      }
    </style>

    <header>
      <div id="header" class="grid-container">
        <div class="grid-item">
          <!-- TODO: No usa imagenes de la ruta local. -->

          <img
            id="logoOCM"
            src="assets/LogoOCMtransparente.png"
            alt="Logo OCM"
          />
        </div>

        <!-- AddToAny BEGIN -->
        <div
          class="grid-item a2a_kit a2a_kit_size_32 a2a_default_style d-flex justify-content-end"
        >
          <!-- TODO: Da error en Facebook en href -->
          <a class="a2a_dd" href="http://www.ocmjerez.org/pactometro/"></a>
          <a class="a2a_button_facebook"></a>
          <a class="a2a_button_twitter"></a>
          <a class="a2a_button_email"></a>
          <a class="a2a_button_whatsapp"></a>
          <a class="a2a_button_telegram"></a>
        </div>
        <script>
          var a2a_config = a2a_config || {};
          a2a_config.locale = "es";
        </script>
        <script async src="https://static.addtoany.com/menu/page.js"></script>
        <!-- AddToAny END -->
      </div>
    </header>

    <div id="pactometro2019">
      <div id="visor">
        <div
          id="mayoria"
          data-tippy="Mayoría absoluta: 14 concejales"
          data-tippy-animation="shift-away"
          data-tippy-arrow="true"
        ></div>
        <div id="recuento" class="recuento">
          <span id="concejales-asignados">0</span>
          <span class="concejales-texto">Concejales asignados</span>
          <span class="concejales-totales">de 27</span>
          <div id="avance">
            <div id="bar"></div>
          </div>
        </div>
        <div id="recuento2" class="recuento">
          <span id="concejales-suma">0</span>
          <span class="concejales-texto">Concejales en tu pacto</span>
          <span class="concejales-totales">elige tus partidos</span>
          <div id="viabilidad" class="cY off">
            <div id="exito" class="cXY off">
              <img
                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDQyNi42NjcgNDI2LjY2NyIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDI2LjY2NyA0MjYuNjY3OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIGNsYXNzPSIiPjxnPjxwYXRoIHN0eWxlPSJmaWxsOiM3MDlEMUEiIGQ9Ik0yMTMuMzMzLDBDOTUuNTE4LDAsMCw5NS41MTQsMCwyMTMuMzMzczk1LjUxOCwyMTMuMzMzLDIxMy4zMzMsMjEzLjMzMyAgYzExNy44MjgsMCwyMTMuMzMzLTk1LjUxNCwyMTMuMzMzLTIxMy4zMzNTMzMxLjE1NywwLDIxMy4zMzMsMHogTTE3NC4xOTksMzIyLjkxOGwtOTMuOTM1LTkzLjkzMWwzMS4zMDktMzEuMzA5bDYyLjYyNiw2Mi42MjIgIGwxNDAuODk0LTE0MC44OThsMzEuMzA5LDMxLjMwOUwxNzQuMTk5LDMyMi45MTh6IiBkYXRhLW9yaWdpbmFsPSIjNkFDMjU5IiBjbGFzcz0iYWN0aXZlLXBhdGgiIGRhdGEtb2xkX2NvbG9yPSIjNzA5ZDFhIj48L3BhdGg+PC9nPiA8L3N2Zz4="
              />
              <span class="desktop">Tu pacto sería viable</span>
              <span class="mobile">Mayoría absoluta</span>
            </div>
            <div id="fracaso" class="cXY off">
              <img
                src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA0OTYuMTU4IDQ5Ni4xNTgiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ5Ni4xNTggNDk2LjE1ODsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSI1MTJweCIgaGVpZ2h0PSI1MTJweCI+CjxwYXRoIHN0eWxlPSJmaWxsOiNFMDRGNUY7IiBkPSJNNDk2LjE1OCwyNDguMDg1YzAtMTM3LjAyMS0xMTEuMDctMjQ4LjA4Mi0yNDguMDc2LTI0OC4wODJDMTExLjA3LDAuMDAzLDAsMTExLjA2MywwLDI0OC4wODUgIGMwLDEzNy4wMDIsMTExLjA3LDI0OC4wNywyNDguMDgyLDI0OC4wN0MzODUuMDg4LDQ5Ni4xNTUsNDk2LjE1OCwzODUuMDg3LDQ5Ni4xNTgsMjQ4LjA4NXoiLz4KPHBhdGggc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIGQ9Ik0yNzcuMDQyLDI0OC4wODJsNzIuNTI4LTg0LjE5NmM3LjkxLTkuMTgyLDYuODc2LTIzLjA0MS0yLjMxLTMwLjk1MSAgYy05LjE3Mi03LjkwNC0yMy4wMzItNi44NzYtMzAuOTQ3LDIuMzA2bC02OC4yMzYsNzkuMjEybC02OC4yMjktNzkuMjEyYy03LjkxLTkuMTg4LTIxLjc3MS0xMC4yMTYtMzAuOTU0LTIuMzA2ICBjLTkuMTg2LDcuOTEtMTAuMjE0LDIxLjc3LTIuMzA0LDMwLjk1MWw3Mi41MjIsODQuMTk2bC03Mi41MjIsODQuMTkyYy03LjkxLDkuMTgyLTYuODgyLDIzLjA0MSwyLjMwNCwzMC45NTEgIGM0LjE0MywzLjU2OSw5LjI0MSw1LjMxOCwxNC4zMTYsNS4zMThjNi4xNjEsMCwxMi4yOTQtMi41ODYsMTYuNjM4LTcuNjI0bDY4LjIyOS03OS4yMTJsNjguMjM2LDc5LjIxMiAgYzQuMzM4LDUuMDQxLDEwLjQ3LDcuNjI0LDE2LjYzNyw3LjYyNGM1LjA2OSwwLDEwLjE2OC0xLjc0OSwxNC4zMTEtNS4zMThjOS4xODYtNy45MSwxMC4yMi0yMS43NywyLjMxLTMwLjk1MUwyNzcuMDQyLDI0OC4wODJ6Ii8+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+Cjwvc3ZnPgo="
              />
              <span class="desktop">No obtendría mayoría</span>
              <span class="mobile">Sin mayoría</span>
            </div>
          </div>
        </div>
        <!-- TODO: Etiquetar la serie y que sean visibles las etiquetas. -->
        <canvas id="myChart"></canvas>
      </div>

      <div id="paso1" class="paso" style="min-height:400px;">
        <h3><span>1</span><span>Configura la Corporación.</span></h3>
        <span class="boton" id="boton-reset" onclick="resetCorporacion()"
          >Vaciar Corporación</span
        >

        <p>
          Esta es la Corporación actual.
          <span class="desktop">Juega a quitar y añadir</span
          ><span class="mobile">Quita y añade</span> concejales hasta construir
          tu Corporación con 27 concejales.
          <span class="desktop">Si prefieres empezar de cero, pulsa sobre </span
          ><!--<span class="mobile">Si lo prefieres, puedes </span>--><br
            class="mobile"
          />
          <span class="reset" onclick="resetCorporacion()"
            >Vaciar Corporación</span
          ><span class="desktop">.</span>
        </p>

        <ul id="ConcejalesPorPartido" class="listapartidos dst8 dstm3">
          <li class="partido-pp selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">PP</span>
            <span class="concejales-partido" bind="any_name">11</span>
            <span class="boton sumar">+</span>
          </li>
          <li class="partido-psoe selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">PSOE</span>
            <span class="concejales-partido">7</span>
            <span class="boton sumar">+</span>
          </li>
          <li class="partido-ganemos selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">Ganemos</span>
            <span class="concejales-partido">5</span>
            <span class="boton sumar">+</span>
          </li>
          <li class="partido-ciudadanos selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">Ciudadanos</span>
            <span class="concejales-partido">2</span>
            <span class="boton sumar">+</span>
          </li>
          <li class="partido-adelante selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">Adelante</span>
            <span class="concejales-partido">2</span>
            <span class="boton sumar">+</span>
          </li>
          <li class="partido-vox selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">Vox</span>
            <span class="concejales-partido">0</span>
            <span class="boton sumar">+</span>
          </li>
          <li class="partido-jerezanos selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">Jerezanos</span>
            <span class="concejales-partido">0</span>
            <span class="boton sumar">+</span>
          </li>
          <li class="partido-axsi selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">AxSi</span>
            <span class="concejales-partido">0</span>
            <span class="boton sumar">+</span>
          </li>
          <li class="partido-pcpa selector box">
            <span class="boton restar">-</span>
            <span class="nombre-partido">PCPA</span>
            <span class="concejales-partido">0</span>
            <span class="boton sumar">+</span>
          </li>
        </ul>
      </div>

      <div id="paso2" class="paso">
        <h3><span>2</span><span>Simula un pacto</span></h3>
        <div id="mensajes">
          <p class="no-completado">
            Podrás simular tu pacto de Gobierno una vez hayas configurado la
            Corporación al completo (27 concejales).
          </p>
          <p class="completado">
            Ahora que todos los concejales están asignados, estás listo para
            pactar.<br /><span class="button">Empezar</span>
          </p>
          <p class="completado pactos">
            <span class="mobile"
              >Es el momento de pactar: pulsa sobre cada partido hasta alcanzar
              mayoría absoluta (14 concejales)</span
            >
            <span class="desktop"
              >Es el momento de hacer tu pacto: simúlalo pulsando sobre cada
              partido hasta alcanzar mayoría absoluta (14 concejales).</span
            >
          </p>
        </div>

        <ul
          id="ConcejalesApuesta"
          class="listapartidos dst16 dstm4 row d-flex justify-content-center"
          style="min-height:80px;"
        >
          <li
            class="partido-pp selector box"
            style="min-height:80px;; min-width:80px;"
          >
            <span class="nombre-partido nombre-partido-short">PP</span>
            <span class="concejales-partido" bind="any_name">11</span>
          </li>
          <li
            class="partido-psoe selector box"
            style="min-height:80px;; min-width:80px;"
          >
            <span class="nombre-partido nombre-partido-short">PSOE</span>
            <span class="concejales-partido">7</span>
          </li>
          <li
            class="partido-ganemos selector box"
            style="min-height:80px;; min-width:80px;"
          >
            <span class="nombre-partido">Ganemos</span>
            <span class="nombre-partido-short">Ganemos</span>
            <span class="concejales-partido">5</span>
          </li>
          <li
            class="partido-ciudadanos selector box"
            style="min-height:80px; min-width:80px;"
          >
            <span class="nombre-partido">Ciudadanos</span>
            <span class="nombre-partido-short">Ciudadanos</span>
            <span class="concejales-partido">2</span>
          </li>
          <li
            class="partido-adelante selector box"
            style="min-height:80px;; min-width:80px;"
          >
            <span class="nombre-partido nombre-partido-short">Adelante</span>
            <span class="concejales-partido">2</span>
          </li>
          <li
            class="partido-vox selector box"
            style="min-height:80px;; min-width:80px;"
          >
            <span class="nombre-partido nombre-partido-short">Vox</span>
            <span class="concejales-partido">0</span>
          </li>
          <li
            class="partido-jerezanos selector box"
            style="min-height:80px;; min-width:80px;"
          >
            <span class="nombre-partido nombre-partido-short">Jerezanos</span>
            <span class="concejales-partido">0</span>
          </li>
          <li
            class="partido-axsi selector box"
            style="min-height:80px;; min-width:80px;"
          >
            <span class="nombre-partido nombre-partido-short">AxSi</span>
            <span class="concejales-partido">0</span>
          </li>
          <li
            class="partido-pcpa selector box"
            style="min-height:80px;; min-width:80px;"
          >
            <span class="nombre-partido">PCPA</span>
            <span class="nombre-partido nombre-partido-short">PCPA</span>
            <span class="concejales-partido">0</span>
          </li>
        </ul>
      </div>

      <div id="paso3" class="imagen">
        <h3><span>3</span><span>Toma una imagen para compartir</span></h3>
        <div id="mensajes">
          <p class="no-completado">
            Podrás tomar una imagen para compartir una vez hayas configurado la
            Corporación al completo (27 concejales) y configurado un pacto
            viable (al menos 14 concejales).
          </p>
          <p class="completado">
            Ahora que todos los concejales están asignados, puedes guardar una
            imagen con tu predicción.<br /><span
              class="button"
              id="boton-img"
              onclick="takeScreenShot()"
              >Tomar imagen</span
            >
          </p>

          <!-- <p class="completado pactos"><span class="mobile">Es el momento de pactar: pulsa sobre cada partido hasta alcanzar mayoría absoluta (14 concejales)</span>
            <span class="desktop">Es el momento de hacer tu pacto: simúlalo pulsando sobre cada partido hasta alcanzar mayoría absoluta (14 concejales).</span></p> -->
        </div>
      </div>
    </div>

    <script>
      const concejalesIniciales = [11, 7, 5, 2, 2, 0, 0, 0, 0];

      function cambiarDatos(chart, data, datasetIndex) {
        chart.data.datasets[datasetIndex].data = data;
        chart.update();
      }

      var ctx = document.getElementById("myChart").getContext('2d');
      var myChart = new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: [
            "PP",
            "PSOE",
            "Ganemos",
            "Ciudadanos",
            "Adelante",
            "Vox",
            "Jerezanos",
            "AxSi",
            "PCPA",
            "Por asignar"
          ],

          datasets: [
            {
              label: "Escaños",
              data: concejalesIniciales,
              backgroundColor: [
                "#049CDD", //PP
                "#DD0612", //PSOE
                "#00B9AC", //Ganemos
                "#F88201", //Ciudadanos
                "#196CAC", //Adelante Jerez
                "#5AC135", //Vox
                "#144F8E", //Jerezanos
                "#8AC13F", //AxSi
                "#D3231A", //PCPA
                "rgba(234, 234, 234, 1)" //POR ASIGNAR
              ],

              borderColor: [
                "rgba(255, 255, 255, 1)",
                "rgba(255, 255, 255, 1)",
                "rgba(255, 255, 255, 1)",
                "rgba(255, 255, 255, 1)",
                "rgba(255, 255, 255, 1)",
                "rgba(255, 255, 255, 1)",
                "rgba(255, 255, 255, 1)",
                "rgba(255, 255, 255, 1)",
                "rgba(255, 255, 255, 1)",
                "rgba(255, 255, 255, 1)"
              ],

              borderWidth: 1
            }
          ]
        },
        options: {
          rotation: 1 * Math.PI,
          circumference: 1 * Math.PI,
          legend: { display: false },
          tooltips: {
            fontSize: 40,
            xPadding: 10,
            yPadding: 10,
            intersect: false
          }
        }
      });

      /// Add and configure Series
      // var pieSeries =chart.series.push(new Chart.PieSeries());
      // pieSeries.dataFields.value =concejalesIniciales;
      // pieSeries.dataFields.category = myChart.labels;

      //MOSTRAR CAJAS PARTIDOS
      function mostrarCajasPartidos(selector) {
        $(selector).removeClass("shown");
        $(selector).each(function(i, el) {
          $(el)
            .delay(40 * i)
            .queue(function() {
              $(this)
                .addClass("shown")
                .dequeue();
            });
        });
      }
      mostrarCajasPartidos(" #paso1 ul.listapartidos li");

      //CALCULO CONCEJALES CONFIGURADOS
      function GetTotalConcejales() {
        totalConcejales = 0;
        arrayConcejales = [];
        $(" #paso1 ul.listapartidos li").each(function() {
          var numConcejalesSingle = parseInt(
            $(this)
              .find("span.concejales-partido")
              .text()
          );
          totalConcejales = totalConcejales + numConcejalesSingle;
          //array partidos
          arrayConcejales.push(numConcejalesSingle);
          faltanConcejales = 27 - totalConcejales;
        });

        //actualizar barra progreso
        $(" #visor #recuento #concejales-asignados").text(totalConcejales);
        var porcentajeProgresoBarra = (totalConcejales * 100) / 27;
        $(" #visor #recuento #avance #bar").width(
          porcentajeProgresoBarra + "%"
        );

        //actualizar Corporación
        arrayConcejales.push(faltanConcejales);
        cambiarDatos(myChart, arrayConcejales, 0);

        //estado
        if (totalConcejales == 27) {
          corporacionCompletada = "si";
          $("#pactometro2019").addClass("completado");
        } else {
          corporacionCompletada = "no";
          $("#pactometro2019").removeClass("completado");
          $("#pactometro2019").removeClass("mostrar-imagen");
        }

        return totalConcejales;
      }
      GetTotalConcejales();

      //RESET CORPORACIÓN
      function resetCorporacion() {
        $(" .paso ul.listapartidos .selector .concejales-partido").text(0);
        GetTotalConcejales();
      }

      //SUMAR Y RESTAR
      //Mensajes
      function showError(tipo, modal) {
        if (tipo == "completado") {
          Swal.fire({
            title: "¡Corporación completada!",
            text:
              "Has asignado los 27 concejales de la Corporación. Simula ahora tu pacto o, si prefieres hacer algún cambio, redistruye los concejales.",
            confirmButtonText: "Redistribuir concejales",
            cancelButtonText: "Pactar",
            showCancelButton: true
          }).then(result => {
            if (result.value) {
              //console.log("seguir configurando");
            } else if (result.dismiss === Swal.DismissReason.cancel) {
              modoPactos();
            }
          });
        } else if (tipo == "minimo") {
          Swal.fire({
            title: "Has llegado al mínimo",
            text: "Un partido no puede tener menos de 0 concejales",
            confirmButtonText: "Aceptar"
          });
        } else if (tipo == "insuficiente") {
          Swal.fire({
            title: "Aún te quedan " + modal + " concejales por asignar",
            text:
              "Para poder realizar tu pacto, es necesario asignar todos los concejales de Corporacion (27 concejales)",
            confirmButtonText: "Aceptar"
          });
        } else if (tipo == "tope") {
          Swal.fire({
            title: "Ya están asignados todos los concejales",
            text: "Resta concejales de otro partido e inténtalo de nuevo.",
            confirmButtonText: "Aceptar"
          });
          Swal.fire({
            title: "Ya están asignados todos los concejales",
            text:
              "Resta concejales de otro partido e inténtalo de nuevo. Si lo prefieres, simula ahora tu pacto.",
            confirmButtonText: "Seguir configurando",
            cancelButtonText: "Pactar",
            showCancelButton: true
          }).then(result => {
            if (result.value) {
              //console.log("seguir configurando");
            } else if (result.dismiss === Swal.DismissReason.cancel) {
              modoPactos();
            }
          });
        }
      }

      function asignarConcejales(operacion, objeto) {
        GetTotalConcejales();
        var objNumConcejales = $(" #paso1 ul.listapartidos li." + objeto).find(
          ".concejales-partido"
        );
        var objNumConcejalesTodos = $("li." + objeto).find(
          ".concejales-partido"
        );
        numConcejalesSingle = parseInt(objNumConcejales.text());
        if (operacion == "sumar") {
          if (totalConcejales == 26) {
            numConcejalesSingle = numConcejalesSingle + 1;
            //showError("completado");
          } else if (totalConcejales == 27) {
            showError("tope");
          } else if (numConcejalesSingle < 27 && totalConcejales < 27) {
            numConcejalesSingle = numConcejalesSingle + 1;
          } else {
            showError("tope");
          }
        } else if (operacion == "restar") {
          if (numConcejalesSingle > 0) {
            numConcejalesSingle = numConcejalesSingle - 1;
          } else {
            showError("minimo");
          }
        }
        $(objNumConcejalesTodos).text(numConcejalesSingle);
        GetTotalConcejales();
      }

      $(" #paso1 ul.listapartidos li span.boton").click(function() {
        //var objNumConcejales = $(this).parent().find(".concejales-partido");
        var partidoClass = $(this)
          .parent()
          .attr("class")
          .split(" ")[0];
        if ($(this).hasClass("sumar")) {
          asignarConcejales("sumar", partidoClass);
        } else if ($(this).hasClass("restar")) {
          asignarConcejales("restar", partidoClass);
        }
      });

      //LONG PRESS
      !(function(o) {
        o.fn.longpress = function(e, n, t) {
          return (
            void 0 === t && (t = 500),
            this.each(function() {
              var u,
                i,
                r = o(this);
              function c(n) {
                u = new Date().getTime();
                var r = o(this);
                i = setTimeout(function() {
                  "function" == typeof e
                    ? e.call(r, n)
                    : o.error(
                        "Callback required for long press. You provided: " +
                          typeof e
                      );
                }, t);
              }
              function s(e) {
                new Date().getTime() - u < t &&
                  (clearTimeout(i),
                  "function" == typeof n
                    ? n.call(o(this), e)
                    : void 0 === n ||
                      o.error(
                        "Optional callback for short press should be a function."
                      ));
              }
              function a(o) {
                clearTimeout(i);
              }
              r.on("mousedown", c),
                r.on("mouseup", s),
                r.on("mousemove", a),
                r.on("touchstart", c),
                r.on("touchend", s),
                r.on("touchmove", a);
            })
          );
        };
      })(jQuery);
      var interval;
      $(" #paso1 ul.listapartidos li span.boton")
        .longpress(function() {
          var thislongpress = $(this);
          var partidoClass = $(this)
            .parent()
            .attr("class")
            .split(" ")[0];
          function performWhileMouseDown() {
            //definir operacion
            if (thislongpress.hasClass("sumar")) {
              operacion = "sumar";
            } else {
              operacion = "restar";
            }
            //ejecutar
            if (totalConcejales == 27 && operacion == "sumar") {
              clearInterval(interval);
              showError("completado");
            } else if (
              thislongpress
                .parent()
                .find(".concejales-partido")
                .text() == 0 &&
              operacion == "restar"
            ) {
              clearInterval(interval);
              showError("minimo");
            } else {
              asignarConcejales(operacion, partidoClass);
            }
          }
          interval = setInterval(performWhileMouseDown, 20);
        })
        .bind("mouseup touchend", function() {
          clearInterval(interval);
        })
        .bind("mousedown touchstart", function() {});

      // PACTOS: VIABILIDAD
      function checkViabilidadPacto(numeroConcejales) {
        $("#pactometro2019").removeClass("mostrar-imagen");
        if (numeroConcejales == 0) {
          $(" #visor .recuento #viabilidad").addClass("off");
          $(" #visor .recuento #viabilidad > div")
            .removeClass("on")
            .addClass("off");
        } else if (numeroConcejales < 14) {
          $(" #visor .recuento #viabilidad").removeClass("off");
          $(" #visor .recuento #viabilidad #exito")
            .removeClass("on")
            .addClass("off");
          $(" #visor .recuento #viabilidad #fracaso")
            .addClass("on")
            .removeClass("off");
          return "inviable";
        } else {
          $(" #visor .recuento #viabilidad #exito")
            .addClass("on")
            .removeClass("off");
          $(" #visor .recuento #viabilidad #fracaso")
            .removeClass("on")
            .addClass("off");

          $("#pactometro2019").addClass("mostrar-imagen");

          return "viable";
        }
      }

      // PACTOS
      function initPactos() {
        $(
          "#pactometro2019.completado.pactos > #visor #recuento2 #concejales-suma"
        ).text(0);
        $("#visor #recuento2 .concejales-totales").text("Elige tus partidos");
        // Remueve la frase de espera y el botón "EMPEZAR"
        $("#paso2 ul.listapartidos li").removeClass("seleccionado");

        corporacionPactos = [0, 0, 0, 0, 0, 0, 0, 0, 0, 27];
        partidosPactos = [];
        cambiarDatos(myChart, corporacionPactos, 0);
        checkViabilidadPacto(0);
      }

      function modoPactos() {
        $(" #paso2 ul.listapartidos li").removeClass("shown");
        $(" #paso1").addClass("off");
        $("#pactometro2019").addClass("pactos");
        initPactos();
        setTimeout(function() {
          mostrarCajasPartidos(" #paso2 ul.listapartidos li");
        }, 300);
      }

      function modoCorporacion() {
        GetTotalConcejales();
        $(" #paso1").removeClass("off");
        $("#pactometro2019").removeClass("pactos pactosinit");
        mostrarCajasPartidos(" #paso1 ul.listapartidos li");
      }

      $(" #paso2").click(function() {
        if (
          !$("#pactometro2019").hasClass("pactos") &&
          !$("#pactometro2019").hasClass("completado")
        ) {
          showError("insuficiente", faltanConcejales);
        }
      });

      $(" #paso2 p .button").click(function() {
        modoPactos();
      });

      $(" #paso1").click(function() {
        if ($(this).hasClass("off")) {
          modoCorporacion();
        }
      });

      //PACTOS: CLICK EN PARTIDO
      $(" #paso2 > .listapartidos li").click(function() {
        //recabar datos
        var numConcejalesSingle = parseInt(
          $(this)
            .find(".concejales-partido")
            .text()
        );
        var childPartido = $(this).index();
        var nombrePartido = $(this)
          .find(".nombre-partido-short")
          .text();
        function getSum(total, num) {
          return total + num;
        }

        //SI NO HA SIDO SELECCIONADO AUN
        if (!$(this).hasClass("seleccionado")) {
          //asignar número de concejales al índice del array correspondiente al partido
          corporacionPactos[childPartido] = numConcejalesSingle;
          //reset número concejales sin asignar en el pacto
          corporacionPactos[9] = 0;
          //sumar en array nombres partidos
          partidosPactos.push(nombrePartido);
          $(" #visor #recuento2 .concejales-totales").text("");
          $.each(partidosPactos, function(index, value) {
            $(" #visor #recuento2 .concejales-totales").append(
              '<span class="' +
                value +
                '">' +
                value +
                '</span><span class="mas"> + </span> '
            );
          });
          //get suma concejales partidos en el pacto
          corporacionPactosTotal = corporacionPactos.reduce(getSum);
          $(
            "#pactometro2019.completado.pactos > #visor #recuento2 #concejales-suma"
          ).text(corporacionPactosTotal);
          //get total sin asignar
          corporacionPactosTotalSinAsignar = 27 - corporacionPactosTotal;
          corporacionPactos[9] = corporacionPactosTotalSinAsignar;
          //marcar como seleccionado
          $(this).addClass("seleccionado");

          //SI YA HA SIDO SELECCIONADO
        } else {
          //asignar número de concejales al índice del array correspondiente al partido
          corporacionPactos[childPartido] = 0;
          //reset número concejales sin asignar en el pacto
          corporacionPactos[9] = 0;
          //restar en array de nombres partidos
          partidosPactos = partidosPactos.filter(function(e) {
            return e !== nombrePartido;
          });

          $(
            " #visor .recuento .concejales-totales span." + nombrePartido
          ).remove();
          if (partidosPactos.length == 1) {
            $(" #visor .recuento .concejales-totales span.mas").remove();
          }
          //get suma concejales partidos en el pacto
          corporacionPactosTotal = corporacionPactos.reduce(getSum);
          $(
            "#pactometro2019.completado.pactos > #visor #recuento2 #concejales-suma"
          ).text(corporacionPactosTotal);
          //get total sin asignar
          corporacionPactosTotalSinAsignar = 27 - corporacionPactosTotal;
          corporacionPactos[9] = corporacionPactosTotalSinAsignar;
          //marcar como seleccionado
          $(this).removeClass("seleccionado");
        }
        if (partidosPactos == 0) {
          $(" #visor #recuento2 .concejales-totales").text(
            "elige tus partidos"
          );
        }
        //¿exito en el pacto?
        checkViabilidadPacto(corporacionPactosTotal);

        cambiarDatos(myChart, corporacionPactos, 0);
      });

      // https://makitweb.com/take-screenshot-of-webpage-with-html2canvas/
      function takeScreenShot() {
        // html2canvas(document.getElementById('ConcejalesPorPartido')).then(function(canvas) {
        // html2canvas(document.getElementById('ConcejalesApuesta')).then(function(canvas) {
        // html2canvas(document.getElementById('html')).then(function(canvas) {

        // TODO: Grabar parte de la pantalla en función si se ha abierto un pacto o no.
        let p1 = document.getElementById("paso1");
        p1.style.display = "none";
        let p3 = document.getElementById("paso3");
        p3.style.display = "none";
        let fo = document.getElementById("footer");
        fo.style.visibility = "hidden";
        let re = document.getElementById("recuento");
        re.style.visibility = "hidden";
        let he = document.getElementById("header");
        he.style.visibility = "hidden";
        

        html2canvas(document.querySelector("body")).then(function(canvas) {
          // document.body.appendChild(canvas);
          var a = document.createElement("a");
          a.href = canvas
            .toDataURL("image/jpeg")
            .replace("image/jpeg", "image/octet-stream");
          a.download = "ApuestaConcejales.jpg";
          a.click();
          p1.style.display = "block";
          p3.style.display = "block";
          fo.style.visibility = "visible";
          re.style.visibility = "visible";
          he.style.visibility = "visible";
        });
      }
    </script>
    <app-root></app-root>

    <footer>
      <div id="footer" class="grid-container">
        <div class="grid-item">
          <span>© </span><span>2019 OCM Jerez. Ver 1.01.00</span>
        </div>

        <!-- TODO: No funcionan los iconos en SVG -->
        <!-- <div class="col-4">
          <a href="https://www.facebook.com/OcmJerez/" class="rk-social-btn ">
            <svg>
              <use xlink:href="symbols.svg#icon-facebook"></use>
            </svg>
          </a>
          <a href="https://twitter.com/ocmjerez" class="rk-social-btn ">
            <svg>
              <use xlink:href="symbols.svg#icon-twitter"></use>
            </svg>
          </a>
        </div> -->

        <div id="facebook" class="grid-item">
          <a href="https://www.facebook.com/OcmJerez" target="_blank"
            >Facebook</a
          >
        </div>

        <div id="twitter" class="grid-item">
          <a href="https://twitter.com/ocmjerez" target="_blank">Twitter</a>
        </div>

        <div class="grid-item">
          <span>Email: </span
          ><span
            ><a href="mailto:info@ocmjerez.org">info@ocmjerez.org</a>
          </span>
        </div>
      </div>
    </footer>
  </body>
</html>
